<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ - Ø®Ø¯Ù…Ø§Øª Ù…Ù†Ø²Ù„ÙŠØ©</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      direction: rtl;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .header {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      text-align: center;
    }

    .header h1 {
      color: #2c3e50;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .header p {
      color: #7f8c8d;
      font-size: 1rem;
    }

    .booking-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .calendar-section, .booking-form {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    .section-title {
      color: #2c3e50;
      font-size: 1.5rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Calendar Styles */
    .calendar {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .calendar-header h3 {
      color: #2c3e50;
      font-size: 1.2rem;
    }

    .calendar-nav {
      display: flex;
      gap: 10px;
    }

    .nav-btn {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      border: none;
      background: white;
      color: #667eea;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s;
    }

    .nav-btn:hover {
      background: #667eea;
      color: white;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day-header {
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      color: #7f8c8d;
      padding: 8px;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
      border: 2px solid transparent;
    }

    .calendar-day:hover {
      background: #e8ecf9;
    }

    .calendar-day.disabled {
      color: #bdc3c7;
      cursor: not-allowed;
    }

    .calendar-day.disabled:hover {
      background: transparent;
    }

    .calendar-day.selected {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
    }

    .calendar-day.today {
      border-color: #667eea;
    }

    .calendar-day.has-booking {
      position: relative;
    }

    .calendar-day.has-booking::after {
      content: '';
      position: absolute;
      bottom: 3px;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #e74c3c;
    }

    /* Time Slots */
    .time-slots {
      margin-top: 20px;
    }

    .time-slots h4 {
      color: #2c3e50;
      font-size: 1.1rem;
      margin-bottom: 15px;
    }

    .slots-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .time-slot {
      padding: 12px;
      border: 2px solid #e1e8ed;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      font-size: 14px;
    }

    .time-slot:hover {
      border-color: #667eea;
      background: #e8ecf9;
    }

    .time-slot.selected {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border-color: transparent;
    }

    .time-slot.disabled {
      background: #f8f9fa;
      color: #bdc3c7;
      cursor: not-allowed;
      border-color: #ecf0f1;
    }

    .time-slot.disabled:hover {
      border-color: #ecf0f1;
      background: #f8f9fa;
    }

    /* Booking Form */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      color: #2c3e50;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .form-control {
      width: 100%;
      padding: 15px;
      border: 2px solid #e1e8ed;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s;
    }

    .form-control:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
    }

    textarea.form-control {
      resize: vertical;
      min-height: 100px;
    }

    .booking-summary {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .booking-summary h4 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #e1e8ed;
    }

    .summary-item:last-child {
      border-bottom: none;
    }

    .summary-label {
      color: #7f8c8d;
      font-size: 14px;
    }

    .summary-value {
      color: #2c3e50;
      font-weight: 600;
      font-size: 14px;
    }

    .submit-btn {
      width: 100%;
      padding: 18px;
      border: none;
      border-radius: 15px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
    }

    .submit-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .submit-btn:disabled {
      background: #95a5a6;
      cursor: not-allowed;
      transform: none;
    }

    /* Bookings List */
    .my-bookings {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-top: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    .booking-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
      border: 2px solid #e1e8ed;
      transition: all 0.3s;
    }

    .booking-card:hover {
      border-color: #667eea;
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
    }

    .booking-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .booking-status {
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-confirmed {
      background: #d4edda;
      color: #155724;
    }

    .status-cancelled {
      background: #f8d7da;
      color: #721c24;
    }

    .booking-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .detail-item {
      font-size: 14px;
    }

    .detail-label {
      color: #7f8c8d;
      font-size: 12px;
    }

    .detail-value {
      color: #2c3e50;
      font-weight: 600;
    }

    .booking-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .action-btn {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-confirm {
      background: #27ae60;
      color: white;
    }

    .btn-cancel {
      background: #e74c3c;
      color: white;
    }

    .btn-reschedule {
      background: #3498db;
      color: white;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .booking-grid {
        grid-template-columns: 1fr;
      }

      .slots-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .booking-details {
        grid-template-columns: 1fr;
      }
    }

    /* Alert */
    .alert {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .alert.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“… Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯</h1>
      <p>Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ</p>
    </div>

    <div class="alert" id="alertMessage"></div>

    <div class="booking-grid">
      <!-- Calendar Section -->
      <div class="calendar-section">
        <h2 class="section-title">ğŸ“† Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®</h2>
        
        <div class="calendar">
          <div class="calendar-header">
            <h3 id="currentMonth"></h3>
            <div class="calendar-nav">
              <button class="nav-btn" onclick="previousMonth()">â€º</button>
              <button class="nav-btn" onclick="nextMonth()">â€¹</button>
            </div>
          </div>

          <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <div class="time-slots" id="timeSlots" style="display: none;">
          <h4>â° Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª</h4>
          <div class="slots-grid" id="slotsGrid"></div>
        </div>
      </div>

      <!-- Booking Form -->
      <div class="booking-form">
        <h2 class="section-title">ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²</h2>

        <div class="booking-summary">
          <h4>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø¬Ø²</h4>
          <div class="summary-item">
            <span class="summary-label">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
            <span class="summary-value" id="summaryDate">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Ø§Ù„ÙˆÙ‚Øª:</span>
            <span class="summary-value" id="summaryTime">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Ø§Ù„Ù…Ù‡Ù†ÙŠ:</span>
            <span class="summary-value" id="summaryProfessional">Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù†ÙŠ</span>
          </div>
        </div>

        <div class="form-group">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
          <select class="form-control" id="serviceType">
            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</option>
            <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
            <option value="ØªØ±ÙƒÙŠØ¨">ØªØ±ÙƒÙŠØ¨</option>
            <option value="Ø¥ØµÙ„Ø§Ø­">Ø¥ØµÙ„Ø§Ø­</option>
            <option value="Ø§Ø³ØªØ´Ø§Ø±Ø©">Ø§Ø³ØªØ´Ø§Ø±Ø©</option>
            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
          </select>
        </div>

        <div class="form-group">
          <label>ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø£Ùˆ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
          <textarea class="form-control" id="description" placeholder="Ø§Ø´Ø±Ø­ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡..."></textarea>
        </div>

        <div class="form-group">
          <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
          <input type="text" class="form-control" id="location" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„">
        </div>

        <div class="form-group">
          <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ØªÙˆØ§ØµÙ„</label>
          <input type="tel" class="form-control" id="phone" placeholder="07XXXXXXXX">
        </div>

        <button class="submit-btn" id="submitBtn" onclick="submitBooking()" disabled>
          ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
        </button>
      </div>
    </div>

    <!-- My Bookings -->
    <div class="my-bookings">
      <h2 class="section-title">ğŸ“‹ Ø­Ø¬ÙˆØ²Ø§ØªÙŠ</h2>
      <div id="bookingsList">
        <div style="text-align: center; padding: 40px; color: #95a5a6;">
          <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ“…</div>
          <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ø¹Ø¯</p>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { 
      getFirestore, 
      collection,
      doc,
      setDoc,
      getDoc,
      getDocs,
      query,
      where,
      orderBy,
      serverTimestamp,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCj5YjdiruBTCfxDnxlDd4W6YA5iCWRfE4",
      authDomain: "home-services-app-a9c5e.firebaseapp.com",
      projectId: "home-services-app-a9c5e",
      storageBucket: "home-services-app-a9c5e.appspot.com",
      messagingSenderId: "287028219636",
      appId: "1:287028219636:web:2ad4b0e092a2c007e318a1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentDate = new Date();
    let selectedDate = null;
    let selectedTime = null;
    let currentUser = null;
    let professionalId = null;

    // Initialize
    checkAuth();
    getProfessionalFromURL();
    renderCalendar();
    loadBookings();

    function checkAuth() {
      const customerLoggedIn = localStorage.getItem('customerLoggedIn');
      if (customerLoggedIn !== 'true') {
        alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        window.location.href = 'customer-auth-page.html';
        return;
      }

      currentUser = {
        email: localStorage.getItem('customerEmail'),
        name: localStorage.getItem('customerName'),
        phone: localStorage.getItem('customerPhone')
      };

      document.getElementById('phone').value = currentUser.phone;
    }

    function getProfessionalFromURL() {
      const params = new URLSearchParams(window.location.search);
      professionalId = params.get('professional');
      
      if (professionalId) {
        loadProfessionalInfo(professionalId);
      }
    }

    async function loadProfessionalInfo(id) {
      try {
        const professionalDoc = await getDoc(doc(db, "approvedUsers", id));
        if (professionalDoc.exists()) {
          const data = professionalDoc.data();
          document.getElementById('summaryProfessional').textContent = data.name;
        }
      } catch (error) {
        console.error('Error loading professional:', error);
      }
    }

    // Render Calendar
    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();

      document.getElementById('currentMonth').textContent = 
        new Date(year, month).toLocaleDateString('ar-SA', { year: 'numeric', month: 'long' });

      const grid = document.getElementById('calendarGrid');
      grid.innerHTML = '';

      // Day headers
      const days = ['Ø³', 'Ø¬', 'Ø®', 'Ø±', 'Ø«', 'Ù†', 'Ø­'];
      days.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-day-header';
        header.textContent = day;
        grid.appendChild(header);
      });

      // First day of month
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      // Empty cells
      for (let i = 0; i < firstDay; i++) {
        grid.appendChild(document.createElement('div'));
      }

      // Days
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day';
        dayEl.textContent = day;

        if (date < today) {
          dayEl.classList.add('disabled');
        } else {
          dayEl.onclick = () => selectDate(date);
          
          if (date.getTime() === today.getTime()) {
            dayEl.classList.add('today');
          }

          if (selectedDate && date.getTime() === selectedDate.getTime()) {
            dayEl.classList.add('selected');
          }
        }

        grid.appendChild(dayEl);
      }
    }

    function selectDate(date) {
      selectedDate = date;
      selectedTime = null;
      renderCalendar();
      generateTimeSlots();
      updateSummary();
    }

    function generateTimeSlots() {
      const slotsContainer = document.getElementById('timeSlots');
      const slotsGrid = document.getElementById('slotsGrid');
      
      slotsContainer.style.display = 'block';
      slotsGrid.innerHTML = '';

      // Generate slots from 8 AM to 8 PM
      for (let hour = 8; hour < 20; hour++) {
        const slot = document.createElement('div');
        slot.className = 'time-slot';
        
        const time = `${hour.toString().padStart(2, '0')}:00`;
        slot.textContent = time;
        
        // Random availability for demo
        if (Math.random() > 0.3) {
          slot.onclick = () => selectTime(time);
          
          if (selectedTime === time) {
            slot.classList.add('selected');
          }
        } else {
          slot.classList.add('disabled');
        }

        slotsGrid.appendChild(slot);
      }
    }

    function selectTime(time) {
      selectedTime = time;
      generateTimeSlots();
      updateSummary();
      document.getElementById('submitBtn').disabled = false;
    }

    function updateSummary() {
      document.getElementById('summaryDate').textContent = 
        selectedDate ? selectedDate.toLocaleDateString('ar-SA') : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±';
      
      document.getElementById('summaryTime').textContent = 
        selectedTime || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±';
    }

    window.nextMonth = function() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    }

    window.previousMonth = function() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    }

    window.submitBooking = async function() {
      if (!selectedDate || !selectedTime) {
        showAlert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª', 'error');
        return;
      }

      const serviceType = document.getElementById('serviceType').value;
      const description = document.getElementById('description').value;
      const location = document.getElementById('location').value;
      const phone = document.getElementById('phone').value;

      if (!serviceType || !description || !location || !phone) {
        showAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
        return;
      }

      const bookingData = {
        customerId: currentUser.email.replace(/\./g, '_'),
        customerName: currentUser.name,
        customerPhone: phone,
        professionalId: professionalId,
        professionalName: document.getElementById('summaryProfessional').textContent,
        date: selectedDate.toISOString(),
        time: selectedTime,
        serviceType: serviceType,
        description: description,
        location: location,
        status: 'pending',
        createdAt: serverTimestamp()
      };

      try {
        const bookingId = `booking_${Date.now()}`;
        await setDoc(doc(db, "bookings", bookingId), bookingData);

        showAlert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­! ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ù‡Ù†ÙŠ', 'success');
        
        // Reset form
        document.getElementById('serviceType').value = '';
        document.getElementById('description').value = '';
        document.getElementById('location').value = '';
        selectedDate = null;
        selectedTime = null;
        renderCalendar();
        document.getElementById('timeSlots').style.display = 'none';
        document.getElementById('submitBtn').disabled = true;
        updateSummary();

        // Reload bookings
        setTimeout(loadBookings, 2000);

      } catch (error) {
        console.error('Booking error:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø¬Ø²ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
      }
    }

    async function loadBookings() {
      try {
        const customerId = currentUser.email.replace(/\./g, '_');
        const bookingsQuery = query(
          collection(db, "bookings"),
          where("customerId", "==", customerId),
          orderBy("createdAt", "desc")
        );

        const snapshot = await getDocs(bookingsQuery);
        const container = document.getElementById('bookingsList');
        container.innerHTML = '';

        if (snapshot.empty) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #95a5a6;">
              <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ“…</div>
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ø¹Ø¯</p>
            </div>
          `;
          return;
        }

        snapshot.forEach((doc) => {
          const booking = doc.data();
          const card = createBookingCard(doc.id, booking);
          container.appendChild(card);
        });

      } catch (error) {
        console.error('Load bookings error:', error);
      }
    }

    function createBookingCard(id, booking) {
      const card = document.createElement('div');
      card.className = 'booking-card';

      const statusClass = {
        'pending': 'status-pending',
        'confirmed': 'status-confirmed',
        'cancelled': 'status-cancelled'
      }[booking.status] || 'status-pending';

      const statusText = {
        'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
        'confirmed': 'Ù…Ø¤ÙƒØ¯',
        'cancelled': 'Ù…Ù„ØºÙŠ'
      }[booking.status] || booking.status;

      const date = new Date(booking.date);

      card.innerHTML = `
        <div class="booking-header">
          <h4>${booking.professionalName}</h4>
          <span class="booking-status ${statusClass}">${statusText}</span>
        </div>

        <div class="booking-details">
          <div class="detail-item">
            <div class="detail-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
            <div class="detail-value">${date.toLocaleDateString('ar-SA')}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Ø§Ù„ÙˆÙ‚Øª</div>
            <div class="detail-value">${booking.time}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</div>
            <div class="detail-value">${booking.serviceType}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</div>
            <div class="detail-value">${booking.location}</div>
          </div>
        </div>

        <div class="booking-actions">
          ${booking.status === 'pending' ? `
            <button class="action-btn btn-cancel" onclick="cancelBooking('${id}')">
              Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²
            </button>
          ` : ''}
        </div>
      `;

      return card;
    }

    window.cancelBooking = async function(bookingId) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ')) return;

      try {
        await updateDoc(doc(db, "bookings", bookingId), {
          status: 'cancelled',
          cancelledAt: serverTimestamp()
        });

        showAlert('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadBookings();

      } catch (error) {
        console.error('Cancel error:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ù„ØºØ§Ø¡', 'error');
      }
    }

    function showAlert(message, type) {
      const alert = document.getElementById('alertMessage');
      alert.className = `alert ${type}`;
      alert.textContent = message;
      alert.style.display = 'block';

      setTimeout(() => {
        alert.style.display = 'none';
      }, 5000);
    }
  </script>
</body>
</html>